<div class="outer">
  <div class="container">
    <% cache @user do %>
      <h1><%= t('entries.index.user_hours', user: @user.first_name) %></h1>
      <div class="hours-per-project-overview">
        <canvas id="hours-per-project" data-data="<%= @user.hours_per_project.to_json %>" width=200 height=200 ></canvas>
        <div class="spent-info">
          <span class="hours" style="color: #D66278"><%= @user.hours_spent %></span>
        </div>
      </div>
      <ul class="legend">
        <% @user.projects.each do |project| %>
          <li>
          <span class="color" style="background-color: <%= project.name.pastel_color %>"></span> <%= project.name %>: <%= @user.percentage_spent_on(project).round %>% (<%= @user.hours_spent_on(project) %><%= t('entries.index.hours_indication') %>)
          </li>
        <% end %>
        <li><strong><%= t('entries.index.total', hours_spent: @user.hours_spent) %><%= t('entries.index.hours_indication') %></strong></li>
      </ul>
    <% end %>
    <table class="entries">
      <thead>
        <tr>
          <th width="10%"><%= t("entries.index.date") %></th>
          <th width="12%"><%= t("entries.index.project") %></th>
          <th width="8%" class="center"><%= t("entries.index.hours") %></th>
          <th width="20%" class="hide-for-mobile"><%= t("entries.index.category") %></th>
          <th width="40%" class="hide-for-mobile"><%= t("entries.index.description") %></th>
          <% if @user == current_user %>
            <th></th>
          <% end %>
        </tr>
      </thead>
      <tbody>
      <% @entries.each do |entry| %>
        <% cache cache_key_for_current_user(entry) do %>
          <tr class="info-row">
            <td><%= l(entry.date) %></td>
            <td><%= link_to entry.project.name, entry.project %></td>
            <td class="center"><%= entry.hours %></td>
            <td class="hide-for-mobile">
              <div class="project">
                <span class="color" style="background-color:<%= entry.category.name.pastel_color %>;"></span>
                <span><%= entry.category.name %></span>
              </div>
            </td>
            <td class="hide-for-mobile">
              <div class="table-description">
                <%= sanitize autolink_tags(entry.description) %>
              </div>
            </td>
            <% if @user == current_user %>
              <td class="right">
                <%= link_to t('entries.index.edit'), edit_entry_path(entry) %> |
                <%= link_to t('entries.index.delete'), entry, method: :delete, class: "destroy", data: { confirm: t(:confirm) } %>
              </td>
            <% end %>
          <% end %>
        </tr>
      <% end %>
      </tbody>
    </table>
    <%= paginate @entries %>
  </div>
</div>
